# Тесты сервисов

[← Назад](../README.md)

Тесты сервисов для работы с внешними данными и состоянием сессии.

## Что проверяем

- Корректную сборку URL и параметров запросов.
- Нормализацию входных данных и валидацию ответов.
- Типы ошибок и коды ошибок, возвращаемые сервисом.
- Побочные эффекты (например, запись в `localStorage`).

## Подход

- Запросы тестируйте через `vi.stubGlobal('fetch', ...)`.
- Формируйте фейковый `Response` с `ok`, `status`, `json()`.
- Для состояния сессии используйте `localStorage.clear()` в `beforeEach`.

Пример мок-ответа:

```ts
const createResponse = (options: { ok: boolean; status: number; payload?: unknown }) =>
  ({
    ok: options.ok,
    status: options.status,
    json: vi.fn().mockResolvedValue(options.payload),
  }) as Response
```

## Список тестов

### `tests/services/auth.spec.ts`

| Тест | Описание |
| --- | --- |
| `формирует корректный URL авторизации` | Проверяет сборку URL авторизации по базовому API. |
| `возвращает sid для валидных данных и нормализует логин` | Проверяет успешную авторизацию, выдачу SID и нормализацию логина. |
| `сохраняет, читает и очищает sid в хранилище` | Проверяет работу с session id в localStorage. |
| `отклоняет авторизацию при пустом логине` | Проверяет отклонение авторизации при пустом логине. |
| `отклоняет авторизацию при пустом пароле` | Проверяет отклонение авторизации при пустом пароле. |
| `отклоняет авторизацию при неверном логине` | Проверяет ошибку при неверном логине. |
| `отклоняет авторизацию при неверном пароле` | Проверяет ошибку при неверном пароле. |
| `выбрасывает ошибку для непредвиденных статусов` | Проверяет обработку ошибок с неизвестными статусами. |
| `выбрасывает ошибку, если sid отсутствует в ответе` | Проверяет валидацию ответа без SID. |
